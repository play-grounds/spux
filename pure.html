<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="A layout example that shows off a responsive email layout."
    />
    <title>Email App</title>
    <base href="https://purecss.io/layouts/email/" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/purecss@2.0.3/build/pure-min.css"
      integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://play-grounds.github.io/spux/css/pure.css"
    />

    <script type="application/ld+json" id="data">
      [
        { "@id": "" },
        { "@id": "PostList", "posts": ["#post1", "#post2", "#post3"] },
        {
          "@id": "#post1",
          "@type": "Post",
          "author": "Tilo Mitra",
          "title": "Hello from Toronto",
          "description": "Hey, I just wanted to check in with you from Toronto. I got here earlier today.",
          "avatar": "/img/common/tilo-avatar.png"
        },
        {
          "@id": "#post2",
          "@type": "Post",
          "author": "Eric Ferraiuolo",
          "title": "Re: Pull Requests",
          "description": "Hey, I had some feedback for pull request #51. We should center the menu so it looks better on mobile.",
          "avatar": "/img/common/ericf-avatar.png"
        },
        {
          "@id": "#post3",
          "@type": "Post",
          "author": "YUI Library",
          "title": "You have 5 bugs assigned to you",
          "description": "Duis aute irure dolor in reprehenderit in voluptate velit essecillum dolore eu fugiat nulla.",
          "avatar": "/img/common/yui-avatar.png"
        },
        {
          "@id": "#post4",
          "@type": "Post",
          "author": "Reid Burke",
          "title": "Re: Design Language",
          "description": "DuExcepteur sint occaecat cupidatat non proident, sunt in culpa.",
          "avatar": "/img/common/reid-avatar.png"
        },
        {
          "@id": "#post5",
          "@type": "Post",
          "author": "Andrew Wooldridge",
          "title": "YUI Blog Updates",
          "description": "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip.",
          "avatar": "/img/common/andrew-avatar.png"
        },
        {
          "@id": "#post6",
          "@type": "Post",
          "author": "Yahoo! Finance",
          "title": "How to protect your finances from winter storms",
          "description": "Mauris tempor mi vitae sem aliquet pharetra. Fusce in dui purus, nec malesuada mauris.",
          "avatar": "/img/common/yfinance-avatar.png"
        },
        {
          "@id": "#post7",
          "@type": "Post",
          "author": "Yahoo! News",
          "title": "Summary for April 3rd, 2020",
          "description": "We found 10 news articles that you may like.",
          "avatar": "/img/common/ynews-avatar.png"
        },
        {
          "@id": "#ui",
          "selected": "#post1"
        }
      ]
    </script>

    <script type="module">
      import { h, html, render, Component } from 'https://cdn.skypack.dev/spux'
      import 'https://cdn.skypack.dev/dior'
      import updateThis from 'https://unpkg.com/spux-modules/updatethis.js'

      globalThis.findById = (id, arr) => {
        arr = arr || di.data

        return arr.find(a => {
          if (a.children && a.children.length > 0) {
            return a['@id'] === id ? true : findById(a.children, id)
          } else {
            return a['@id'] === id
          }
        })
        return a
      }

      const Post = props => {
        var selected = findById('#ui').selected
        var visibility =
          selected === props.lo['@id']
            ? 'email-item-selected'
            : 'email-item-unread'
        console.log('selected', selected)
        return html`
          <div
            class="email-item pure-g ${visibility}"
            onClick=${() => {
              di.data[9].selected = props.lo['@id']
              renderAll()
            }}
          >
            <div class="pure-u">
              <img
                width="64"
                height="64"
                alt="${props.lo.avatar}"
                class="email-avatar"
                src="${props.lo.avatar}"
              />
            </div>

            <div class="pure-u-3-4">
              <h5 class="email-name">${props.lo.author}</h5>
              <h4 class="email-subject">${props.lo.title}</h4>
              <p class="email-desc">
                ${props.lo.description}
              </p>
            </div>
          </div>
        `
      }

      const Element = props => {
        var lo = findById(props.id)
        if (!lo) return
        var type = lo['@type']
        if (!type) return
        props.lo = lo

        return eval(type)(props)
      }

      const Elements = props => {
        return di.data
          .filter(i => i['@type'] === props.type)
          .map(i => {
            return html`
              <${Element} id=${i['@id']} />
            `
          })
      }

      const Message = props => {
        var selected = findById('#ui').selected
        var message = findById(selected)
        console.log('message', message)
        return html`
          <div class="email-content">
            <div class="email-content-header pure-g">
              <div class="pure-u-1-2">
                <h1 class="email-content-title">${message.title}</h1>
                <p class="email-content-subtitle">
                  From <a>${message.author}</a> at
                  <span>3:56pm, April 3, 2012</span>
                </p>
              </div>

              <div class="email-content-controls pure-u-1-2">
                <button class="secondary-button pure-button">
                  Reply
                </button>
                <button class="secondary-button pure-button">
                  Forward
                </button>
                <button class="secondary-button pure-button">
                  Move to
                </button>
              </div>
            </div>

            <div class="email-content-body">
              <p>
                ${message.description}.
              </p>
            </div>
          </div>
        `
      }

      globalThis.renderAll = () => {
        render(
          html`
            <div id="layout" class="content pure-g">
              <div id="nav" class="pure-u">
                <a href="#" class="nav-menu-button">Menu</a>

                <div class="nav-inner">
                  <button class="primary-button pure-button">Compose</button>

                  <div class="pure-menu">
                    <ul class="pure-menu-list">
                      <li class="pure-menu-item">
                        <a href="#" class="pure-menu-link"
                          >Inbox <span class="email-count">(2)</span></a
                        >
                      </li>
                      <li class="pure-menu-item">
                        <a href="#" class="pure-menu-link">Important</a>
                      </li>
                      <li class="pure-menu-item">
                        <a href="#" class="pure-menu-link">Sent</a>
                      </li>
                      <li class="pure-menu-item">
                        <a href="#" class="pure-menu-link">Drafts</a>
                      </li>
                      <li class="pure-menu-item">
                        <a href="#" class="pure-menu-link">Trash</a>
                      </li>
                      <li class="pure-menu-heading">Labels</li>
                      <li class="pure-menu-item">
                        <a href="#" class="pure-menu-link"
                          ><span class="email-label-personal"></span>Personal</a
                        >
                      </li>
                      <li class="pure-menu-item">
                        <a href="#" class="pure-menu-link"
                          ><span class="email-label-work"></span>Work</a
                        >
                      </li>
                      <li class="pure-menu-item">
                        <a href="#" class="pure-menu-link"
                          ><span class="email-label-travel"></span>Travel</a
                        >
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div id="list" class="pure-u-1">
                <${Elements} type="Post" />
              </div>

              <div id="main" class="pure-u-1">
                <${Message} type="Post" />
              </div>
            </div>
          `,
          document.body
        )
      }
      renderAll()
    </script>
  </head>
  <body></body>
</html>
