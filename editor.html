<html>
  <head>
    <script type="application/json" id="data">"<div><b><u><i>Edit me! editing here....</i></u></b></div><div><b><u><i><br></i></u></b></div><div><i>View Source to see <b>Data Island</b><br></i><u><i></i></u><b><u><i></i></u></b></div><div><i><b><br></b></i></div><div><i><b>It works!!!</b></i></div><div><i><b><br></b></i></div><div><i><b>it sure does.!</b></i></div>"</script>
  </head>
</html>

<link
  rel="stylesheet"
  type="text/css"
  href="https://unpkg.com/pell/dist/pell.min.css"
/>

<script src="https://unpkg.com/pell"></script>

<script type="module">
  import 'https://unpkg.com/dataisland?module'
  var id = 'data'

  function updateThis (id) {
    fetch(location.href).then(response =>
      response.text().then(html => {
        var newhtml = html.replace(
          /(<script[^>]*type="application[^>]*>)([\s\S]*?)(<\/script>)/gim,
          '$1' + JSON.stringify(di[id], null, 2) + '$3'
        )
        console.log('updating', newhtml, html)
        if (newhtml !== html) {
          fetch(location.href, {
            method: 'PUT',
            body: newhtml,
            headers: {
              'content-type': 'text/html'
            }
          }).then(console.log)
        }
      })
    )
  }

  // Initialize pell on an HTMLElement
  var editor = pell.init({
    // <HTMLElement>, required
    element: document.body,

    // <Function>, required
    // Use the output html, triggered by element's `oninput` event
    onChange: html => {
      console.log(html)
      di.data = html
    },

    // <string>, optional, default = 'div'
    // Instructs the editor which element to inject via the return key
    defaultParagraphSeparator: 'div',

    // <boolean>, optional, default = false
    // Outputs <span style="font-weight: bold;"></span> instead of <b></b>
    styleWithCSS: false,

    // <Array[string | Object]>, string if overwriting, object if customizing/creating
    // action.name<string> (only required if overwriting)
    // action.icon<string> (optional if overwriting, required if custom action)
    // action.title<string> (optional)
    // action.result<Function> (required)
    // Specify the actions you specifically want (in order)
    actions: [
      'bold',
      {
        name: 'custom',
        icon: 'S',
        title: 'Save',
        result: () => {
          console.log('Save!')
          updateThis('data')
        }
      },
      'underline'
    ],

    // classes<Array[string]> (optional)
    // Choose your custom class names
    classes: {
      actionbar: 'pell-actionbar',
      button: 'pell-button',
      content: 'pell-content',
      selected: 'pell-button-selected'
    }
  })

  editor.content.innerHTML = di.data

  // Execute a document command, see reference:
  // https://developer.mozilla.org/en/docs/Web/API/Document/execCommand
  // this is just `document.execCommand(command, false, value)`
  //   pell.exec(command<string>, value<string>)
</script>

